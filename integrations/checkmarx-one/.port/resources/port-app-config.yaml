createMissingRelatedEntities: true
deleteDependentEntities: true
resources:
  - kind: project
    selector:
      query: 'true'
    port:
      entity:
        mappings:
          blueprint: '"checkmarxProject"'
          identifier: .id
          title: .name
          properties:
            name: .name
            createdAt: .createdAt
            updatedAt: .updatedAt
            tags: (.tags // {})
            repoUrl: .repoUrl
            mainBranch: .mainBranch
            origin: .origin
            criticality: .criticality

  - kind: scan
    selector:
      query: 'true'
    port:
      entity:
        mappings:
          blueprint: '"checkmarxScan"'
          identifier: .id
          title: '(.projectId + "-" + .id)'
          properties:
            status: .status
            branch: .branch
            createdAt: .createdAt
            updatedAt: .updatedAt
            projectId: .projectId
            userAgent: .userAgent
            configs: (.configs // {})
            statusDetails: (.statusDetails // [])
          relations:
            project: .projectId


  - kind: scan_result
    selector:
      query: 'true'
    port:
      entity:
        mappings:
          identifier: .id
          title: .description
          # Blueprint name → checkmarx + Type (with leading char upper‑cased)
          blueprint: >
            "checkmarx" +
            (.type        | .[0:1] | ascii_upcase) +
            (.type        | .[1:])
          properties:
            type: .type
            severity: .severity
            state: .state
            confidenceLevel: .confidenceLevel
            description: .description
            cweId: (.vulnerabilityDetails.cweId // empty)
            fileName: (.data.nodes[0].fileName // empty)
            line: (.data.nodes[0].line // empty)
        relations:
          scan: .__scan_id
