entityDeletionThreshold: 0
resources:
  - kind: copilot-team-metrics
    selector:
      query: 'true'
    port:
      entity:
        mappings:
          identifier: (.__team.slug + "@" + .date)
          title: (.__team.slug + " copilot-metrics " + .date)
          blueprint: '"github_copilot_usage"'
          properties:
            record_date: .date  + "T00:00:00Z"
            breakdown: .
            total_suggestions_count: >-
              [.copilot_ide_code_completions.editors[]?.models[]?.languages[]?.total_code_suggestions]
              | map(select(. != null) ) | add
            total_acceptances_count: >-
              [.copilot_ide_code_completions.editors[]?.models[]?.languages[]?.total_code_acceptances]
              | map(select(. != null)) | add
            total_lines_suggested: >-
              [.copilot_ide_code_completions.editors[]?.models[]?.languages[]?.total_code_lines_suggested]
              | map(select(. != null)) | add
            total_lines_accepted: >-
              [.copilot_ide_code_completions.editors[]?.models[]?.languages[]?.total_code_lines_accepted]
              | map(select(. != null)) | add
            total_active_users: .total_active_users
            total_chat_acceptances: >-
              [
                (.copilot_ide_chat.editors[]?.models[]?.total_chat_copy_events // 0),
                (.copilot_ide_chat.editors[]?.models[]?.total_chat_insertion_events // 0)
              ]
              | map(select(. != null)) | add
            total_chat_turns: >-
              [.copilot_ide_chat.editors[]?.models[]?.total_chats // 0]
              | map(select(. != null)) | add
            total_active_chat_users: >-
              [.copilot_ide_chat.editors[]?.total_engaged_users // 0]
              | map(select(. != null)) | add
            git_hub_org: .__organization.login
            git_hub_team: .__team.slug
  - kind: copilot-organization-metrics
    selector:
      query: 'true'
    port:
      entity:
        mappings:
          identifier: (.__organization.login + "@" + .date)
          title: (.__organization.login + " copilot-metrics " + .date)
          blueprint: '"github_copilot_usage"'
          properties:
            record_date: .date  + "T00:00:00Z"
            breakdown: .
            total_suggestions_count: >-
              [.copilot_ide_code_completions.editors[]?.models[]?.languages[]?.total_code_suggestions]
              | map(select(. != null) ) | add
            total_acceptances_count: >-
              [.copilot_ide_code_completions.editors[]?.models[]?.languages[]?.total_code_acceptances]
              | map(select(. != null)) | add
            total_lines_suggested: >-
              [.copilot_ide_code_completions.editors[]?.models[]?.languages[]?.total_code_lines_suggested]
              | map(select(. != null)) | add
            total_lines_accepted: >-
              [.copilot_ide_code_completions.editors[]?.models[]?.languages[]?.total_code_lines_accepted]
              | map(select(. != null)) | add
            total_active_users: .total_active_users
            total_chat_acceptances: >-
              [
                (.copilot_ide_chat.editors[]?.models[]?.total_chat_copy_events // 0),
                (.copilot_ide_chat.editors[]?.models[]?.total_chat_insertion_events // 0)
              ]
              | map(select(. != null)) | add
            total_chat_turns: >-
              [.copilot_ide_chat.editors[]?.models[]?.total_chats // 0]
              | map(select(. != null)) | add
            total_active_chat_users: >-
              [.copilot_ide_chat.editors[]?.total_engaged_users // 0]
              | map(select(. != null)) | add
            git_hub_org: .__organization.login
  - kind: copilot-organization-billing
    selector:
      query: 'true'
    port:
      entity:
        mappings:
          identifier: .__organization.login
          title: (.__organization.login + " Copilot Billing")
          blueprint: '"github_copilot_billing"'
          properties:
            organization: .__organization.login
            seat_breakdown: .seat_breakdown
            total_seats: .seat_breakdown.total
            active_seats: .seat_breakdown.active_this_cycle
            inactive_seats: .seat_breakdown.inactive_this_cycle
            added_this_cycle: .seat_breakdown.added_this_cycle
            pending_invitation: .seat_breakdown.pending_invitation
            pending_cancellation: .seat_breakdown.pending_cancellation
            seat_management_setting: .seat_management_setting
            ide_chat: .ide_chat
            platform_chat: .platform_chat
            cli: .cli
            public_code_suggestions: .public_code_suggestions
            plan_type: .plan_type
  - kind: copilot-seat-assignments
    selector:
      query: 'true'
    port:
      entity:
        mappings:
          identifier: (.__organization.login + "-" + .assignee.login)
          title: (.assignee.login + " Copilot Seat")
          blueprint: '"github_copilot_seat"'
          properties:
            organization: .__organization.login
            username: .assignee.login
            user_id: .assignee.id
            user_type: .assignee.type
            user_avatar_url: .assignee.avatar_url
            user_url: .assignee.html_url
            created_at: .created_at
            updated_at: .updated_at
            pending_cancellation_date: .pending_cancellation_date
            last_activity_at: .last_activity_at
            last_activity_editor: .last_activity_editor
            last_authenticated_at: .last_authenticated_at
            plan_type: .plan_type
            assigning_team_name: .assigning_team.name
            assigning_team_slug: .assigning_team.slug
            assigning_team_url: .assigning_team.html_url
          relations:
            billing: .__organization.login
